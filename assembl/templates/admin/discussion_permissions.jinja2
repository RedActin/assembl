{% extends 'base.jinja2' %}

{% block content %}
<div class="admin-permissions">
<h2>{% trans %}Discussion {% endtrans %}{{discussion.topic}}</h2>
<h3>{% trans %}Role permissions:{% endtrans %}</h3>
<form method="POST" action="#">
<table id="role_permissions" class="table">
    <thead>
        <th>{% trans %}Permissions{% endtrans %}\{% trans %}Roles{% endtrans %}</th>
        {% for role in roles %}
        <th>
            {{role}}
        </th>
        {% endfor %}
    </thead>
    <tbody>
        {% for permission in permissions %}
        <tr>
            <th>{{permission}}</th>
            {% for role in roles %}
            <td>
                <input type="checkbox" name="allowed_{{role}}_{{permission}}" 
                {% if allowed(role,permission) %} checked {% endif %}
                {% if role == 'r:sysadmin' %}disabled="true"{% endif %}
                >
            </td>
            {% endfor %}
        </tr>
        {% endfor %}
        <tr>
        <th>{% trans %}delete role{% endtrans %}</th>
        {% for role in roles %}
            <td>
                <input type="checkbox" name="delete_{{role}}"
                {% if is_system_role(role) %}disabled="true"{% endif %}
                >
            </td>
        {% endfor %}
        </tr>
        <tr>
            <th><input type="submit" name="submit_add_role" value="{% trans %}Add a role{% endtrans %}"></th>
            <th colspan="{{roles|length}}">r:<input name="new_role"/></th>
        </tr>
    </tbody>
</table>
<input type="submit" name="submit_role_permissions" value="{% trans %}Save{% endtrans %}">
</form>
<h3>{% trans %}User roles specific to this discussion:{% endtrans %}</h3>
<form method="POST" action="#">
<table>
    <thead>
        <th>{% trans %}Users{% endtrans %}\{% trans %}Roles{% endtrans %}</th>
        {% for role in roles %}
        {% if role.startswith('r:') %}
        <th>
            {{role}}
        </th>
        {% endif %}
        {% endfor %}
    </thead>
    <tbody>
        {% for user in users %}
        <tr>
            <th>{{user.name}}</th>
            {% for role in roles %}
            {% if role.startswith('r:') %}
            <td>
                <input type="checkbox" name="has_{{role}}_{{user.id}}" 
                {% if has_local_role(user.id,role) %} checked {% endif %}>
            </td>
            {% endif %}
            {% endfor %}
        </tr>
        {% endfor %}
        <tr>
            <th><input type="submit" name="submit_look_for_user" value="{% trans %}Search for users{% endtrans %}"></th>
            <th colspan="{{roles|length}}"><input name="user_search"/></th>
        </tr>
    </tbody>
</table>
<input type="submit" name="submit_user_roles" value="{% trans %}Save{% endtrans %}">
</form>
</div>
{% endblock %}

{% block extra_css %}
{#<style>
table, th, td {
   border: 1px solid grey;
}
th {
   padding: 3px;
}
</style>#}
{% endblock extra_css %}